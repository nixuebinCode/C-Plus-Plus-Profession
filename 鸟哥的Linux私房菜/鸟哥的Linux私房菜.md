# 第2章 主机规划与磁盘分区

## 2.1 各硬件设备在Linux中的文件名

在Linux系统中，每个设备都被当成一个文件来对待

 ![image-20220310192422227](\images\image-20220310192422227.png)

## 2.2 磁盘分区

### 2.2.1 MBR(MS-DOS)与GPT磁盘分区表

#### MBR(Master Boot Record, 主引导记录)分区表格式与限制

启动引导程序及录取与分区表通通放在磁盘的第一个扇区，这个扇区通常是512字节的大小，包括：

* 主引导记录：可以安装启动引导程序的地方，有446字节
* 分区表：记录整块硬盘分区的状态，有64字节

由于分区表所在区块仅有64 Bytes容量，因此最多仅能有四组记录区，每组记录区记录了该区段的启始与结束的柱面号码。注意分区的最小单位通常为柱面。

 ![](\images\1.jpg)

##### 扩展分区

既然分区表只有记录四组数据的空间，那么是否代表我一颗硬盘最多只能分区出四个分区？当然不是。

扩展分区的目的是使用额外的扇区来记录分区信息，扩展分区本身并不能被拿出来格式化。

 ![](\images\2.jpg)

L1~L5是由扩展分区继续切出来的分区，就被称为**逻辑分区**。

上述的分区在Linux系统中的设备文件名分别如下：
P1: /dev/sda1
P2: /dev/sda2
L1: /dev/sda5
L2: /dev/sda6
L3: /dev/sda7
L4: /dev/sda8
L5: /dev/sda9
前面四个号码都是保留给主要分区或扩展分区用的，所有逻辑分区的设备名称号码就由5号开始。

##### MBR主要分区、扩展分区、逻辑分区特性

* 主要分区与扩展分区最多可以有四个（硬盘的限制）
* 扩展分区最多只能有一个（操作系统的限制）
* 逻辑分区是由扩展分区持续划分出来的分区
* 能够被格式化后作为数据存取的分区是主要分区与逻辑分区。扩展分区无法格式化
* 逻辑分区的数量依操作系统而不同，在Linux系统中SATA硬盘已经可以突破63个以上的分区限制

#### GPT(GUID partition table)磁盘分区表

过去一个扇区大小就是512字节，不过目前已经有4K的扇区设计出现。为了兼容所有的磁盘，因此在扇区的定义上面，大多会使用所谓的逻辑区块地址（Logical Block Address, LBA）来处理。

GPT将磁盘的所有区块以此LBA来规划。
与 MBR 仅使用第一个 512Bytes 区块来纪录不同， GPT 使用了 34 个 LBA 区块来纪录分区信息。同时与过去 MBR 仅有一的区块，被干掉就死光光的情况不同， GPT 除了前面 34 个LBA 之外，整个磁盘的最后 34 个 LBA 也拿来作为另一个备份。

### 2.2.2 启动流程中的BIOS

#### BIOS 搭配 MBR/GPT 的启动流程

BIOS是一个写入到主板上的一个固件（固件就是写入到硬件上的一个软件程序）。这个BIOS就是在开机的时候，计算机系统会主动执行的第一个程序。接下来整个启动流程为：

1. BIOS：启动后主动执行的固件，会认识第一个可启动的设备；
2. MBR：第一个可启动设备的第一个扇区内的主引导记录块，内含启动引导代码；
3. 启动引导程序（boot loader）：一个可读取内核文件来执行的软件；
4. 内核文件：开始操作系统的功能。

其中boot loader的主要任务有：

1. 提供菜选项：用户可以选择不同的启动选项，这也是多重引导的重要功能；
2. 加载内核文件：直接指向可使用的程序区段来启动操作系统；
3. 转交其他loader：将启动管理功能转交给其他loader负责。

启动引导程序boot loader除了可以安装在MBR之外，还可以安装在每个分区的启动扇区。

### 2.2.3 Linux安装模式下，磁盘分区的选择

#### 目录树结构

所谓的目录树架构（directory tree）就是以根目录为主，然后向下呈现分支状的目录结构的一种文件架构。

整个目录树架构最重要的就是那个根目录（root directory），这个根目录的表示方法为一条斜线“/”， 所有的文件都与目录树有关。

 ![](\images\3.jpg)

#### 文件系统与目录树的关系（挂载）

我们现在知道整个Linux系统使用的是目录树架构，但是我们的文件数据其实是放置在磁盘分区当中的， 现在的问题是“如何结合目录树的架构与磁盘内的数据”呢？

所谓的挂载，就是利用一个目录当成进入点，将磁盘分区的数据放置在该目录下。也就是进入该目录就可以读取该分区的意思。

例如我们将硬盘分为两个区，分区1挂载到根目录，分区2挂载到/home这个目录。也就是说当我的数据放置在/home内的各次目录时，数据是放置到
分区2的，如果不是放在/home下面的目录， 那么数据就会被放置到分区1了。

 ![](\images\4.jpg)

当我们想知道/home/vbird/test这个文件在哪个分区时，反向追踪，由test --> vbird --> home --> /，看哪个“进入点”先被查到就可以了。所以test使用的是/home这个进入点而不是/。

#### distributions安装时，挂载点与磁盘分区的规划

* 初次接触Linux：只要划分“ / ”及“交换分区”即可

* 建议分区的方法：预留一个备用的剩余磁盘容量

  可以用这个剩余的容量划分出新的分区，并使用它来备份重要的文件。

## 2.3 安装Linux前的规划

 ### 2.3.1 选择适当的Linux发行版

CentOS 7.1版，下载 everything 版本即可：CentOS-7-x86_64-Everything-1503-01.iso

CentOS官方网站：http://mirror.centos.org/centos/7/isos/

中科大镜像站：http://centos.ustc.edu.cn/centos/7/isos/

# 第3、4章 安装CentOS7.x与登录

Linux中，只要文件名的开头是小数点，那么该文件名就不会在一般观察模式被显示出来。所以说，在Linux下面，隐藏文件并不是什么特殊的权限，单纯是因为文件名命名的处理方式不同。

## 4.1 首次登录系统

### 4.1.1 X Window与命令行模式的切换

Linux默认的情况下会提供六个终端来让用户登陆，切换的方式为使用【Ctrl+Alt+F1~F6】的组合键。

* [Ctrl] + [Alt] + [F2] ~ [F6] ：命令行登陆 tty2 ~ tty6 终端机；
* [Ctrl] + [Alt] + [F1] ：图形接口桌面。

### 4.1.2 在终端登录Linux

在终端正确输入账号名和密码之后，能够看到：

 ![image-20220313211512698](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220313211512698.png)

[dmtsai@study ~]$ _

是正确登陆之后才显示的讯息， 最左边的 dmtsai 显示的是“目前使用者的帐号”，而@之后接的 study 则是“主机名称”，至于最右边的~则指的是“目前所在的目录”，那个$则是我们常常讲的“提示字符“。

~ 符号代表的是“用户的家目录”的意思，它是个“变量”，举例来说root的家目录在/root，所以~ 就代表/root的意思。而dmtsai的家目录在/home/dmtsai，所以如果你以dmtsai登录时，~ 就会等价于/home/dmtsai。

在Linux中，默认root的提示字符为#，而一般身份用户的提示字符为$。

#### 离开系统

注销Linux很简单，直接输入`exit`就可以了

但是离开系统并不是关机，Linux本身已经有相当多的任务在进行，你的登录也仅是其中的一个任务而已，所以当你离开时，这次这个登录任务 就停止了，但此时Linux其他的任务还是在继续进行中。

## 4.2 命令行模式下命令的执行

命令行模式登陆后所取得的程序被称为壳（Shell），这是因为这支程序负责最外面跟使用者（我们）沟通，所以才被戏称为壳程序。

我们Linux的壳程序就是厉害的BASH。

### 4.2.1 开始执行命令

#### 命令的格式

`[dmtsai@study ~]$ command [-options] parameter1 parameter2 ...`

* 一行指令中第一个输入的部分绝对是“命令（command）”或“可执行文件（例如shell脚本）”
* 命令, 选项, 参数等这几个东西中间以空格来区分，不论空几格 shell 都视为一格。所以空格是很重要的特殊字符。
* 按下[Enter]按键后，该命令就立即执行。[Enter]按键代表着一行命令的开始启动。
* 命令太长的时候，可以使用反斜线 （\） 来转义回车键，使命令连续到下一行。

### 4.2.2 基础命令的操作

#### 显示日期的命令：date

```c++
[dmtsai@study ~]$ date
Fri May 29 14:32:01 CST 2015
[dmtsai@study ~]$ date +%Y/%m/%d
2015/05/29
[dmtsai@study ~]$ date +%H:%M
14:33
```

#### 显示日历的指令： cal

列出目前这个月的日历

```c++
[dmtsai@study ~]$ cal
May 2015
Su Mo Tu We Th Fr Sa
                1 2
3  4  5  6   7 8   9
10 11 12 13 14 15 16
17 18 19 20 21 22 23
24 25 26 27 28 29 30
31
```

显示整年的月历

```c++
[dmtsai@study ~]$ cal 2015
```

显示2015年10月的月历

```c++
[dmtsai@study ~]$ cal 10 2015
```

#### 简单好用的计算机： bc

在命令行输入bc后，屏幕会显示出版本信息， 之后就进入到等待指示的阶段。

bc默认仅输出整数，如果要输出小数点下位数，那么就必须要执行 scale=number ，那个number就是小数点位数。

要离开bc回到命令行界面时，务必要输入【quit】来离开bc的软件环境。

### 4.2.3 重要的几个热键

#### Tab按键

具有命令补全与文件补齐的功能。

例如在命令行输入ca后，连续按下**两次**【Tab】按键，所以以ca为开头的命令都被显示出来。

#### Ctrl-c按键

中断目前程序的按键。

#### Ctrl-d按键

* 表示键盘输入结束（End Of File）
* 也可以用来取代exit的输入，例如你想要直接离开命令行模式，可以直接按下Ctrl-d就能直接离开，相当于输入exit

#### [shift]+{[Page UP]|[Page Down]}按键

当某些命令的输出信息很长的时候，可能会导致前面的部分已经不在目前的屏幕中，可以使用这两个组合键来往前/往后翻页

## 4.3 Linux系统在线求助man page与info page

### 4.3.1 命令的 --help求助说明

使用命令的--help选项就能够将该命令的用法做一个大致的理解。

### 4.3.2 man page

除了【date --help】之外，还可以执行【man date】，就可以看到date的一大堆用法，出现的屏幕界面，就称它为man page。

 ![image-20220314145036675](\images\image-20220314145036675.png)

其中DATE(1)后面的1表示的是date是一般用户可使用的命令，其它的如下：

1：用户在shell环境中可以操作的命令或可执行文件
5：配置文件或者是某些文件的格式
8：系统管理员可用的管理命令

#### man page中常用的按键

 ![image-20220314145745736](\images\image-20220314145745736.png)

### 4.3.3 info page

info与man的用途其实差不多，但是与man page一口气输出一堆信息不同的是，info page则是将文件数据拆成一个一个的段落，每个段落用自己的页面来编写，并且在各个页面中还有超链接来跳到各个不同的页面中，每个独立的页面也被称为一个节点。

不够查询的命令说明要具有info page功能的话，得用info page的格式来写成在线求助文件才行。至于以非info page格式写的说明文件，虽然也能够使用info来显示，不过其结果就会跟man相同。

## 4.4 超简单的文本编辑器：nano

在nano后面直接加上文件名就能够打开一个旧文件或新文件：`nano text.txt`，文件存在就打开旧文件，不存在就创建新文件。

进入nano后，下方会有组合键的功能，其中指数符号(^)代表的是键盘的[Ctrl]按键。下面列举出几个重要的组合键：

* [ctrl]-G：获得联机帮助（help）
* [ctrl]-X：离开nano软件，若有修改过文件会提示是否需要保存
* [ctrl]-O：保存文件，若你有权限的话就能够保存文件了
* [ctrl]-R：从其他文件读入数据，可以将某个文件的内容贴在本文件中
* [ctrl]-W：查找字符串
* [ctrl]-C：说明目前光标所在处的行数与列数等信息
* [ctrl]-_：可以直接输入行号，让光标快速移动到该行
* [alt]-Y：语法校验功能开启或关闭
* [alt]-M：可以支持鼠标来移动光标的功能

## 4.5 正确的关机方法

### 数据同步写入磁盘：sync

直接在命令行模式下输入sync，那么在内存中尚未被更新的数据，就会被写入硬盘中。所以，这个命令在系统关机或重新启动之前，最好多执行几次。

### 常用的关机命令：shutdown

`shutdown [-krhc] [时间] [警告讯息]`

#### 选项与参数：
-k ： 不要真的关机，只是发送警告信息出去
-r ： 在将系统的服务停掉之后就重新启动（常用）
-h ： 将系统的服务停掉后，立即关机。 （常用）
-c ： 取消已经在进行的 shutdown 命令内容
时间 ： 指定系统关机的时间。若没有这个项目，则默认 1 分钟后自动进行。

#### 使用范例

`[root@study ~]# shutdown -h now`
立刻关机，其中 now 相当于时间为 0 的状态
`[root@study ~]# shutdown -h 20:25`
系统在今天的 20:25 分会关机，若在21:25才下达此指令，则隔天才关机
`[root@study ~]# shutdown -h +10`
系统再过十分钟后自动关机
`[root@study ~]# shutdown -r now`
系统立刻重新开机
`[root@study ~]# shutdown -r +30 'The system will reboot'`
再过三十分钟系统会重新开机，并显示后面的讯息给所有在线上的使用者
`[root@study ~]# shutdown -k now 'This system will reboot'`
仅发出警告信件的参数！系统并不会关机啦！吓唬人！
