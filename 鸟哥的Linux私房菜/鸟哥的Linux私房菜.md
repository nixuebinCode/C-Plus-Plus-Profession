# 第2章 主机规划与磁盘分区

## 2.1 各硬件设备在Linux中的文件名

在Linux系统中，每个设备都被当成一个文件来对待

 ![image-20220310192422227](\images\image-20220310192422227.png)

## 2.2 磁盘分区

### 2.2.1 MBR(MS-DOS)与GPT磁盘分区表

#### MBR(Master Boot Record, 主引导记录)分区表格式与限制

启动引导程序及录取与分区表通通放在磁盘的第一个扇区，这个扇区通常是512字节的大小，包括：

* 主引导记录：可以安装启动引导程序的地方，有446字节
* 分区表：记录整块硬盘分区的状态，有64字节

由于分区表所在区块仅有64 Bytes容量，因此最多仅能有四组记录区，每组记录区记录了该区段的启始与结束的柱面号码。注意分区的最小单位通常为柱面。

 ![](D:\study\C-Plus-Plus-Profession\鸟哥的Linux私房菜\images\1.jpg)

##### 扩展分区

既然分区表只有记录四组数据的空间，那么是否代表我一颗硬盘最多只能分区出四个分区？当然不是。

扩展分区的目的是使用额外的扇区来记录分区信息，扩展分区本身并不能被拿出来格式化。

 ![](D:\study\C-Plus-Plus-Profession\鸟哥的Linux私房菜\images\2.jpg)

L1~L5是由扩展分区继续切出来的分区，就被称为**逻辑分区**。

上述的分区在Linux系统中的设备文件名分别如下：
P1: /dev/sda1
P2: /dev/sda2
L1: /dev/sda5
L2: /dev/sda6
L3: /dev/sda7
L4: /dev/sda8
L5: /dev/sda9
前面四个号码都是保留给主要分区或扩展分区用的，所有逻辑分区的设备名称号码就由5号开始。

##### MBR主要分区、扩展分区、逻辑分区特性

* 主要分区与扩展分区最多可以有四个（硬盘的限制）
* 扩展分区最多只能有一个（操作系统的限制）
* 逻辑分区是由扩展分区持续划分出来的分区
* 能够被格式化后作为数据存取的分区是主要分区与逻辑分区。扩展分区无法格式化
* 逻辑分区的数量依操作系统而不同，在Linux系统中SATA硬盘已经可以突破63个以上的分区限制

#### GPT(GUID partition table)磁盘分区表

过去一个扇区大小就是512字节，不过目前已经有4K的扇区设计出现。为了兼容所有的磁盘，因此在扇区的定义上面，大多会使用所谓的逻辑区块地址（Logical Block Address, LBA）来处理。

GPT将磁盘的所有区块以此LBA来规划。
与 MBR 仅使用第一个 512Bytes 区块来纪录不同， GPT 使用了 34 个 LBA 区块来纪录分区信息。同时与过去 MBR 仅有一的区块，被干掉就死光光的情况不同， GPT 除了前面 34 个LBA 之外，整个磁盘的最后 34 个 LBA 也拿来作为另一个备份。

### 2.2.2 启动流程中的BIOS

#### BIOS 搭配 MBR/GPT 的启动流程

BIOS是一个写入到主板上的一个固件（固件就是写入到硬件上的一个软件程序）。这个BIOS就是在开机的时候，计算机系统会主动执行的第一个程序。接下来整个启动流程为：

1. BIOS：启动后主动执行的固件，会认识第一个可启动的设备；
2. MBR：第一个可启动设备的第一个扇区内的主引导记录块，内含启动引导代码；
3. 启动引导程序（boot loader）：一个可读取内核文件来执行的软件；
4. 内核文件：开始操作系统的功能。

其中boot loader的主要任务有：

1. 提供菜选项：用户可以选择不同的启动选项，这也是多重引导的重要功能；
2. 加载内核文件：直接指向可使用的程序区段来启动操作系统；
3. 转交其他loader：将启动管理功能转交给其他loader负责。

启动引导程序boot loader除了可以安装在MBR之外，还可以安装在每个分区的启动扇区。

### 2.2.3 Linux安装模式下，磁盘分区的选择

#### 目录树结构

所谓的目录树架构（directory tree）就是以根目录为主，然后向下呈现分支状的目录结构的一种文件架构。

整个目录树架构最重要的就是那个根目录（root directory），这个根目录的表示方法为一条斜线“/”， 所有的文件都与目录树有关。

 ![](D:\study\C-Plus-Plus-Profession\鸟哥的Linux私房菜\images\3.jpg)

#### 文件系统与目录树的关系（挂载）

我们现在知道整个Linux系统使用的是目录树架构，但是我们的文件数据其实是放置在磁盘分区当中的， 现在的问题是“如何结合目录树的架构与磁盘内的数据”呢？

所谓的挂载，就是利用一个目录当成进入点，将磁盘分区的数据放置在该目录下。也就是进入该目录就可以读取该分区的意思。

例如我们将硬盘分为两个区，分区1挂载到根目录，分区2挂载到/home这个目录。也就是说当我的数据放置在/home内的各次目录时，数据是放置到
分区2的，如果不是放在/home下面的目录， 那么数据就会被放置到分区1了。

 ![](D:\study\C-Plus-Plus-Profession\鸟哥的Linux私房菜\images\4.jpg)

当我们想知道/home/vbird/test这个文件在哪个分区时，反向追踪，由test --> vbird --> home --> /，看哪个“进入点”先被查到就可以了。所以test使用的是/home这个进入点而不是/。

#### distributions安装时，挂载点与磁盘分区的规划

* 初次接触Linux：只要划分“ / ”及“交换分区”即可

* 建议分区的方法：预留一个备用的剩余磁盘容量

  可以用这个剩余的容量划分出新的分区，并使用它来备份重要的文件。

## 2.3 安装Linux前的规划

 ### 2.3.1 选择适当的Linux发行版

CentOS 7.1版，下载 everything 版本即可：CentOS-7-x86_64-Everything-1503-01.iso

CentOS官方网站：http://mirror.centos.org/centos/7/isos/
中科大镜像站：http://centos.ustc.edu.cn/centos/7/isos/

# 第3章 安装CentOS7.x

